# Pytest Quick Reference Cheatsheet

## Installation
```bash
pip install -r requirements.txt
```

## Running Tests

### Basic Commands
```bash
pytest                          # Run all tests
pytest -v                       # Verbose output
pytest -vv                      # Extra verbose
pytest -s                       # Show print statements
pytest -x                       # Stop on first failure
pytest --lf                     # Run last failed tests
pytest --ff                     # Run failures first, then others
```

### Run Specific Tests
```bash
pytest tests/test_injection.py                                    # Run file
pytest tests/test_injection.py::TestSQLInjection                 # Run class
pytest tests/test_injection.py::TestSQLInjection::test_sql_...   # Run method
```

### Run by Marker
```bash
pytest -m injection             # Injection tests only
pytest -m xss                   # XSS tests only
pytest -m csrf                  # CSRF tests only
pytest -m access_control        # Access control tests only
pytest -m redirects             # Redirect tests only
pytest -m "injection or xss"    # Multiple markers (OR)
pytest -m "not slow"            # Exclude slow tests
```

### Run by Keyword
```bash
pytest -k "sql"                 # Tests with "sql" in name
pytest -k "injection"           # Tests with "injection" in name
pytest -k "not redirect"        # Exclude tests with "redirect"
```

## Coverage Reports

### Terminal Coverage
```bash
pytest --cov=badguys                              # Basic coverage
pytest --cov=badguys --cov-report=term-missing    # Show missing lines
```

### HTML Coverage
```bash
pytest --cov=badguys --cov-report=html            # Generate HTML report
# Then open: htmlcov/index.html
```

### XML Coverage (for CI/CD)
```bash
pytest --cov=badguys --cov-report=xml             # Generate XML report
```

### Multiple Reports
```bash
pytest --cov=badguys --cov-report=term-missing --cov-report=html --cov-report=xml
```

## Output Control

### Traceback Options
```bash
pytest --tb=short               # Short traceback
pytest --tb=line                # One line per failure
pytest --tb=long                # Detailed traceback (default)
pytest --tb=no                  # No traceback
```

### Output Formatting
```bash
pytest -q                       # Quiet mode
pytest --color=yes              # Force color
pytest --color=no               # No color
```

## Test Selection

### By Directory
```bash
pytest tests/                   # All tests in tests/
pytest tests/test_injection.py tests/test_xss.py  # Multiple files
```

### By Pattern
```bash
pytest tests/test_*.py          # All test files
pytest -k "test_sql or test_xss"  # Pattern matching
```

## Debugging

### Drop into Debugger
```bash
pytest --pdb                    # Drop to debugger on failure
pytest --pdb --pdbcls=IPython.terminal.debugger:TerminalPdb  # Use IPython
```

### Show Locals
```bash
pytest -l                       # Show local variables in traceback
pytest --showlocals             # Same as -l
```

## Performance

### Run in Parallel (requires pytest-xdist)
```bash
pip install pytest-xdist
pytest -n auto                  # Auto-detect CPU count
pytest -n 4                     # Use 4 processes
```

### Duration Reports
```bash
pytest --durations=10           # Show 10 slowest tests
pytest --durations=0            # Show all test durations
```

## Useful Combinations

### Development Mode
```bash
pytest -v -s -x                 # Verbose, show prints, stop on first failure
```

### Quick Check
```bash
pytest -x --lf                  # Run last failed, stop on first failure
```

### Full Report
```bash
pytest -v --cov=badguys --cov-report=term-missing --cov-report=html
```

### CI/CD Mode
```bash
pytest --cov=badguys --cov-report=xml --junitxml=junit.xml
```

## Fixtures

### List Available Fixtures
```bash
pytest --fixtures               # Show all fixtures
pytest --fixtures -v            # Verbose fixture info
```

### Use Fixtures in Tests
```python
def test_example(client):                    # Use client fixture
def test_with_user(admin_user):             # Use admin_user fixture
def test_authenticated(authenticated_client): # Use authenticated_client
```

## Markers

### List Available Markers
```bash
pytest --markers                # Show all markers
```

### Available Markers in This Project
- `injection` - Injection vulnerability tests
- `xss` - Cross-site scripting tests
- `csrf` - CSRF vulnerability tests
- `access_control` - Access control tests
- `redirects` - Redirect/forward tests
- `slow` - Slow-running tests
- `django_db` - Tests requiring database

## Configuration

### pytest.ini Location
```
/Users/jace.key/Dev_Workspace/demo-projects/lets-be-bad-guys-python/pytest.ini
```

### Override Config
```bash
pytest -o addopts=""            # Clear default options
pytest --override-ini="python_files=test_*.py"  # Override setting
```

## Common Workflows

### First Time Setup
```bash
pip install -r requirements.txt
pytest -v
```

### Daily Development
```bash
pytest --lf -x                  # Run last failures, stop on first error
pytest -v tests/test_injection.py  # Test specific module
```

### Before Commit
```bash
pytest --cov=badguys --cov-report=term-missing
```

### Full Test Suite
```bash
./run_tests.sh                  # Use convenience script
# OR
pytest -v --cov=badguys --cov-report=html --cov-report=term-missing
```

## Environment Variables

### Django Settings
```bash
export DJANGO_SETTINGS_MODULE=badguys.settings
pytest
```

### Coverage Config
```bash
export COVERAGE_FILE=.coverage.custom
pytest --cov=badguys
```

## Tips & Tricks

### Show Test Collection
```bash
pytest --collect-only           # Show what tests would run
```

### Dry Run
```bash
pytest --collect-only -q        # Quick list of tests
```

### Generate Test Report
```bash
pytest --html=report.html --self-contained-html  # Requires pytest-html
```

### Watch Mode (requires pytest-watch)
```bash
pip install pytest-watch
ptw                             # Auto-run tests on file changes
```

## Exit Codes

- `0` - All tests passed
- `1` - Tests failed
- `2` - Test execution interrupted
- `3` - Internal error
- `4` - Command line usage error
- `5` - No tests collected

## Quick Troubleshooting

### Tests Not Found
```bash
pytest --collect-only           # See what pytest finds
pytest -v tests/                # Explicit path
```

### Import Errors
```bash
# Make sure you're in the project root
cd /Users/jace.key/Dev_Workspace/demo-projects/lets-be-bad-guys-python
pytest
```

### Database Errors
```python
# Add @pytest.mark.django_db to test class or method
@pytest.mark.django_db
def test_example(client):
    # ...
```

### Coverage Not Working
```bash
# Use explicit coverage command
pytest --cov=badguys --cov-report=term
```

## Resources

- Full Guide: `TESTING.md`
- Test Documentation: `tests/README.md`
- Setup Summary: `PYTEST_SETUP_SUMMARY.md`
- pytest docs: https://docs.pytest.org/
- pytest-django: https://pytest-django.readthedocs.io/

---

**Save this file for quick reference! ðŸ“‹**

